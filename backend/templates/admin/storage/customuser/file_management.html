{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block content %}
<div class="file-management">
    <h1>{{ title }}</h1>

    <div class="upload-section" style="margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 5px;">
        <h2>üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞</h2>
        <form method="post" action="{% url 'admin:storage_customuser_upload' user.id %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div style="display: flex; gap: 10px; align-items: end;">
                <div>
                    <label><strong>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª:</strong></label><br>
                    <input type="file" name="file" required style="margin-top: 5px;">
                </div>
                <div>
                    <label><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong></label><br>
                    <input type="text" name="comment" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–∞" style="margin-top: 5px; padding: 5px; width: 200px;">
                </div>
                <div>
                    <button type="submit" class="button" style="margin-top: 5px;">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>
            </div>
        </form>
    </div>

    <div class="files-list">
        <h2>üìÇ –§–∞–π–ª—ã –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ ({{ files.count }})</h2>
        
        {% if files %}
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f5f5f5;">
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">–ò–º—è —Ñ–∞–π–ª–∞</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">–†–∞–∑–º–µ—Ä</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">–î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">–ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                    <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for file in files %}
                <tr>
                    <td style="padding: 10px; border: 1px solid #ddd;"><strong>{{ file.original_name }}</strong></td>
                    <td style="padding: 10px; border: 1px solid #ddd;">{{ file.size|filesizeformat }}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">{{ file.upload_date|date:"d.m.Y H:i" }}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">{{ file.last_download_date|date:"d.m.Y H:i"|default:"‚Äî" }}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">{{ file.comment|default:"‚Äî" }}</td>
                    <td style="padding: 10px; border: 1px solid #ddd;">
                        <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                            <a href="{% url 'admin:storage_customuser_download_file' user.id file.id %}" class="button" style="padding: 5px 10px;">üì• –°–∫–∞—á–∞—Ç—å</a>
                            <a href="{% url 'admin:storage_customuser_rename_file' user.id file.id %}" class="button" style="padding: 5px 10px;">‚úèÔ∏è –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å</a>
                            <a href="{% url 'admin:storage_customuser_delete_file' user.id file.id %}" class="button" style="padding: 5px 10px; background: #dc3545;" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª \"{{ file.original_name }}\"?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="padding: 20px; text-align: center; color: #666;">–í —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–µ—Ç —Ñ–∞–π–ª–æ–≤</p>
        {% endif %}
    </div>
    
    <div class="back-link" style="margin-top: 30px;">
        <a href="{% url 'admin:storage_customuser_changelist' %}" class="button">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</a>
    </div>
</div>
{% endblock %}